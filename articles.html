<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>مقالات وأخبار - أحمد أبو المجد</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Tajawal', sans-serif; background: #f5f5f0; color: #2d3748; cursor: none; }
        .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; }
        .section-title h2 { color: #08137b; }
        .articles-list { display: grid; gap: 18px; }
        .article-item { background: #fff; border-radius: 12px; padding: 18px; box-shadow: 0 6px 18px rgba(0,0,0,0.06); display: grid; grid-template-columns: 1fr 120px; gap: 18px; align-items: center; }
        .article-meta { color: #6b7280; font-size: 14px; margin-bottom: 8px; }
        .read-time { display:flex; gap:8px; align-items:center }
        .reading-circle { width:48px; height:48px; border-radius:50%; display:inline-grid; place-items:center; background:linear-gradient(135deg,#08137b,#4f09a7); color:#fff; font-weight:700 }
        .cta { display:inline-block; background:#08137b; color:#fff; padding:8px 12px; border-radius:8px; text-decoration:none }
        .search-row { display:flex; gap:10px; margin-bottom:20px; }
        .search-row input { flex:1; padding:10px; border-radius:8px; border:1px solid #e5e7eb }
        /* Modal */
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000; }
        .modal.active { display:block }
        .modal-dialog { background:#fff; max-width:900px; margin:40px auto; border-radius:12px; padding:20px; height:80vh; overflow:auto }
        .progress-line { height:6px; background:#eee; border-radius:6px; overflow:hidden; margin-top:10px }
        .progress-line > i { display:block; height:6px; background:linear-gradient(90deg,#08137b,#4f09a7); width:0% }
        @media (max-width: 768px) {
            .article-item { grid-template-columns: 1fr; padding: 12px; }
            .article-item img { width: 100%; height: auto; object-fit: cover; margin-top: 12px; }
            .container { margin: 20px auto; padding: 0 12px; }
            .modal-dialog { margin: 20px auto; max-width: 96%; height: 80vh; }
            .reading-circle { width: 40px; height: 40px; font-size: 0.9rem; }
        }
    </style>
    <link rel="stylesheet" href="/static/css/site-layout.css">
</head>
<body>
    <div class="custom-cursor" id="customCursor"></div>
    <div id="site-header"></div>
    <div class="container">
        <div class="section-title">
            <h2>المقالات والأخبار</h2>
            <p>جمع كل المقالات والأخبار هنا مع زمن القراءة ومؤشرات التقدم.</p>
        </div>

        <div class="search-row">
            <input id="searchInput" placeholder="ابحث عن مقال أو خبر...">
            <a href="index.html" class="cta">العودة للرئيسية</a>
        </div>

        <div id="articlesList" class="articles-list"></div>
    </div>

    <div id="articleModal" class="modal">
        <div class="modal-dialog">
            <button id="closeModal" style="float:left">إغلاق</button>
            <h2 id="modalTitle"></h2>
            <div class="article-meta" id="modalMeta"></div>
            <div class="progress-line"><i id="readProgressBar"></i></div>
            <div id="modalContent" style="margin-top:18px; line-height:1.8"></div>
        </div>
    </div>

    <script>
        async function loadArticles() {
            const res = await fetch('/api/articles.php');
            const data = await res.json();
            const list = document.getElementById('articlesList');
            if (!data.success) return;
            const items = data.articles.filter(a => a.category === 'article' || a.category === 'news');
            list.innerHTML = '';
            items.forEach(a => {
                const div = document.createElement('div'); div.className = 'article-item';
                div.innerHTML = `
                    <div>
                        <div class="article-meta">${a.publish_date} • بواسطة ${a.author}</div>
                        <h3 style="margin:0">${a.title}</h3>
                        <p style="margin-top:8px;color:#374151">${a.excerpt || ''}</p>
                        <div style="margin-top:12px; display:flex; gap:10px; align-items:center">
                            <div class="read-time"><div class="reading-circle">${a.reading_time || '—'}</div><span>دقيقة قراءة</span></div>
                            <a class="cta" href="#" data-slug="${a.slug}">اقرأ الآن</a>
                        </div>
                    </div>
                    <div style="text-align:center">
                        <img src="${a.image_url || 'https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?auto=format&fit=crop&w=400&q=60'}" style="width:110px;height:80px;object-fit:cover;border-radius:8px">
                    </div>
                `;
                list.appendChild(div);
            });

            // attach listeners
            document.querySelectorAll('.cta').forEach(btn => btn.addEventListener('click', openArticle));
        }

        async function openArticle(e) {
            e.preventDefault();
            const slug = this.getAttribute('data-slug');
            const res = await fetch(`/api/articles.php?full=1&slug=${encodeURIComponent(slug)}`);
            const data = await res.json();
            if (!data.success) return alert('خطأ في تحميل المقال');
            const a = data.article;
            document.getElementById('modalTitle').textContent = a.title;
            document.getElementById('modalMeta').textContent = `${a.publish_date} • بواسطة ${a.author} • ${a.reading_time} دقيقة قراءة`;
            document.getElementById('modalContent').innerHTML = a.content;
            document.getElementById('articleModal').classList.add('active');

            // track scroll progress inside modal
            const dialog = document.querySelector('.modal-dialog');
            const progress = document.getElementById('readProgressBar');
            function update() {
                const total = dialog.scrollHeight - dialog.clientHeight;
                const percent = total > 0 ? (dialog.scrollTop / total) * 100 : 0;
                progress.style.width = percent + '%';
            }
            dialog.addEventListener('scroll', update);
            update();
        }

        document.getElementById('closeModal').addEventListener('click', () => document.getElementById('articleModal').classList.remove('active'));
        document.getElementById('searchInput').addEventListener('input', function() {
            const q = this.value.trim().toLowerCase();
            document.querySelectorAll('.article-item').forEach(item => {
                const text = item.innerText.toLowerCase();
                item.style.display = text.includes(q) ? '' : 'none';
            });
        });

        loadArticles();
    </script>
    <div id="site-footer"></div>
    <script src="/static/js/site-layout.js"></script>
</body>
</html>
